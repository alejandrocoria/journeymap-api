/* common */
function addLoadEvent(a){var b=window.onload;"function"!=typeof window.onload?window.onload=a:window.onload=function(){b&&b(),a()}}function supports_canvas(){return!!document.createElement("canvas").getContext}function gaussianBlur(a,b,c){var d=a.width,e=d<<2,f=a.height;if(b){var h,g=b.data;c<0&&(c=0),h=c>=2.5?.98711*c-.9633:c>=.5?3.97156-4.14554*Math.sqrt(1-.26891*c):2*c*(3.97156-4.14554*Math.sqrt(.865545));for(var i=h*h,j=i*h,k=1.57825+2.44413*h+1.4281*i+.422205*j,l=(2.44413*h+2.85619*i+1.26661*j)/k,m=-(1.4281*i+1.26661*j)/k,n=.422205*j/k,o=1-(l+m+n),p=0;p<3;p++)for(var q=0;q<f;q++){for(var r=q*e+p,s=q*e+(d-1<<2)+p,t=g[r],u=t,v=u,w=v;r<=s;r+=4)t=o*g[r]+l*u+m*v+n*w,g[r]=t,w=v,v=u,u=t;for(r=q*e+(d-1<<2)+p,s=q*e+p,t=g[r],u=t,v=u,w=v;r>=s;r-=4)t=o*g[r]+l*u+m*v+n*w,g[r]=t,w=v,v=u,u=t}for(var p=0;p<3;p++)for(var x=0;x<d;x++){for(var r=(x<<2)+p,s=(f-1)*e+(x<<2)+p,t=g[r],u=t,v=u,w=v;r<=s;r+=e)t=o*g[r]+l*u+m*v+n*w,g[r]=t,w=v,v=u,u=t;for(r=(f-1)*e+(x<<2)+p,s=(x<<2)+p,t=g[r],u=t,v=u,w=v;r>=s;r-=e)t=o*g[r]+l*u+m*v+n*w,g[r]=t,w=v,v=u,u=t}return b}}function removeClass(a,b){if(hasClass(a,b)){var c=new RegExp("(\\s|^)"+b+"(\\s|$)");a.className=a.className.replace(c," ")}}function addClass(a,b){this.hasClass(a,b)||(a.className+=" "+b)}function hasClass(a,b){return a.className.match(new RegExp("(\\s|^)"+b+"(\\s|$)"))}var getElementsByClassName=function(a,b,c){return(getElementsByClassName=document.getElementsByClassName?function(a,b,c){c=c||document;for(var g,d=c.getElementsByClassName(a),e=b?new RegExp("\\b"+b+"\\b","i"):null,f=[],h=0,i=d.length;h<i;h+=1)g=d[h],e&&!e.test(g.nodeName)||f.push(g);return f}:document.evaluate?function(a,b,c){b=b||"*",c=c||document;for(var i,j,d=a.split(" "),e="",f="http://www.w3.org/1999/xhtml",g=document.documentElement.namespaceURI===f?f:null,h=[],k=0,l=d.length;k<l;k+=1)e+="[contains(concat(' ', @class, ' '), ' "+d[k]+" ')]";try{i=document.evaluate(".//"+b+e,c,g,0,null)}catch(a){i=document.evaluate(".//"+b+e,c,null,0,null)}for(;j=i.iterateNext();)h.push(j);return h}:function(a,b,c){b=b||"*",c=c||document;for(var g,i,d=a.split(" "),e=[],f="*"===b&&c.all?c.all:c.getElementsByTagName(b),h=[],j=0,k=d.length;j<k;j+=1)e.push(new RegExp("(^|\\s)"+d[j]+"(\\s|$)"));for(var l=0,m=f.length;l<m;l+=1){g=f[l],i=!1;for(var n=0,o=e.length;n<o&&(i=e[n].test(g.className),i);n+=1);i&&h.push(g)}return h})(a,b,c)};
/* paintbrush.js, v0.3 */
function processFilters(){var a=document.createElement("canvas"),b=a.getContext("2d");supports_canvas()&&(addFilter("filter-blur",a,b),addFilter("filter-edges",a,b),addFilter("filter-emboss",a,b),addFilter("filter-greyscale",a,b),addFilter("filter-matrix",a,b),addFilter("filter-mosaic",a,b),addFilter("filter-noise",a,b),addFilter("filter-posterize",a,b),addFilter("filter-sepia",a,b),addFilter("filter-sharpen",a,b),addFilter("filter-tint",a,b))}function addFilter(a,b,c){function h(a,b,c,d,e,f,g){var h=d[e],k=a+"-"+e;if(g.width=f.width=b.width,g.height=f.height=b.height,b&&g){var l=initializeBuffer(g,b);if(l){if("filter-blur"==a&&(l=gaussianBlur(b,l,c.blurAmount)),"filter-edges"==a){var m=[0,1,0,1,-4,1,0,1,0];l=j(b,l,m,c.edgesAmount)}if("filter-emboss"==a){var m=[-2,-1,0,-1,1,1,0,1,2];l=j(b,l,m,c.embossAmount)}if("filter-matrix"==a){var m=[.111,.111,.111,.111,.111,.111,.111,.111,.111];l=j(b,l,m,c.matrixAmount)}if("filter-sharpen"==a){var m=[-1,-1,-1,-1,9,-1,-1,-1,-1];l=j(b,l,m,c.sharpenAmount)}if("filter-tint"==a)var n=parseInt(createColor(c.tintColor),16),o={r:(16711680&n)>>16,g:(65280&n)>>8,b:255&n};if("filter-blur"!=a&&"filter-emboss"!=a&&"filter-matrix"!=a&&"filter-sharpen"!=a)for(var p=0,q=l.data,r=q.length;p<r>>2;p++){var s=p<<2,t={r:q[s],g:q[s+1],b:q[s+2]};l=i(a,c,b,l,s,t,o)}g.putImageData(l,0,0),stashOriginal(b,k,h,f)}}}function i(a,b,c,d,e,f,g){var i,h=d.data,j=c.width;switch(a){case"filter-greyscale":i=.21*f.r+.71*f.g+.07*f.b,h=setRGB(h,e,findColorDifference(b.greyscaleOpacity,i,f.r),findColorDifference(b.greyscaleOpacity,i,f.g),findColorDifference(b.greyscaleOpacity,i,f.b));break;case"filter-mosaic":var k=e>>2,l=Math.floor(k/j),o=l%b.mosaicSize,p=k-l*j,q=p%b.mosaicSize;o&&(k-=o*j),q&&(k-=q),k<<=2,h=setRGB(h,e,findColorDifference(b.mosaicOpacity,h[k],f.r),findColorDifference(b.mosaicOpacity,h[k+1],f.g),findColorDifference(b.mosaicOpacity,h[k+2],f.b));break;case"filter-noise":i=m(b.noiseAmount),h="mono"==b.noiseType||"monochrome"==b.noiseType?setRGB(h,e,n(f.r+i),n(f.g+i),n(f.b+i)):setRGB(h,e,n(f.r+m(b.noiseAmount)),n(f.g+m(b.noiseAmount)),n(f.b+m(b.noiseAmount)));break;case"filter-posterize":h=setRGB(h,e,findColorDifference(b.posterizeOpacity,parseInt(b.posterizeValues*parseInt(f.r/b.posterizeAreas)),f.r),findColorDifference(b.posterizeOpacity,parseInt(b.posterizeValues*parseInt(f.g/b.posterizeAreas)),f.g),findColorDifference(b.posterizeOpacity,parseInt(b.posterizeValues*parseInt(f.b/b.posterizeAreas)),f.b));break;case"filter-sepia":h=setRGB(h,e,findColorDifference(b.sepiaOpacity,.393*f.r+.769*f.g+.189*f.b,f.r),findColorDifference(b.sepiaOpacity,.349*f.r+.686*f.g+.168*f.b,f.g),findColorDifference(b.sepiaOpacity,.272*f.r+.534*f.g+.131*f.b,f.b));break;case"filter-tint":h=setRGB(h,e,findColorDifference(b.tintOpacity,g.r,f.r),findColorDifference(b.tintOpacity,g.g,f.g),findColorDifference(b.tintOpacity,g.b,f.b))}return d}function j(a,b,d,e){var f=document.createElement("canvas"),g=f.getContext("2d");g.width=f.width=a.width,g.height=f.height=a.height,g.drawImage(a,0,0,a.width,a.height);for(var h=g.getImageData(0,0,c.width,c.height),i=b.data,j=h.data,k=a.width,m=Math.sqrt(d.length),n=Math.floor(m/2),o=1;o<k-1;o++)for(var p=1;p<a.height-1;p++){for(var q=sumG=sumB=0,r=0;r<m;r++)for(var s=0;s<m;s++){var t=l(o+s-n,p+r-n,k)<<2,u={r:j[t],g:j[t+1],b:j[t+2]};q+=u.r*d[s+r*m],sumG+=u.g*d[s+r*m],sumB+=u.b*d[s+r*m]}var v=l(o,p,k)<<2,w={r:i[v],g:i[v+1],b:i[v+2]};i=setRGB(i,v,findColorDifference(e,q,w.r),findColorDifference(e,sumG,w.g),findColorDifference(e,sumB,w.b))}return b}function l(a,b,c){return a+b*c}function m(a){return Math.floor((a>>1)-Math.random()*a)}function n(a){return a<0?0:a>255?255:a}var d=getElementsByClassName(a.toLowerCase());for(var e in d){var f=getFilterParameters(d[e]),g=getReferenceImage(d[e]);g.onLoad=h(a,g,f,d,e,b,c)}}function getFilterParameters(a){var b={blurAmount:1,edgesAmount:1,embossAmount:.25,greyscaleOpacity:1,matrixAmount:1,mosaicOpacity:1,mosaicSize:5,noiseAmount:30,noiseType:"mono",posterizeAmount:5,posterizeOpacity:1,sepiaOpacity:1,sharpenAmount:.25,tintColor:"#FFF",tintOpacity:.3};for(var c in b){var d=c.replace(/([A-Z])/g,function(a,b){return"-"+b.toLowerCase()}),e=a.getAttribute("data-pb-"+d);e&&(b[c]=e)}return b.tintColor=a.getAttribute("data-pb-tint-colour")||b.tintColor,b.posterizeAreas=256/b.posterizeAmount,b.posterizeValues=255/(b.posterizeAmount-1),b}function initializeBuffer(a,b){if(a.clearRect(0,0,a.width,a.height),b.width>0&&b.height>0)try{return a.drawImage(b,0,0,b.width,b.height),a.getImageData(0,0,a.width,a.height)}catch(a){}}function createColor(a){return a=a.replace(/^#/,""),3==a.length&&(a=a.replace(/(.)/g,"$1$1")),a}function findColorDifference(a,b,c){return a*b+(1-a)*c}function setRGB(a,b,c,d,e){return a[b]=c,a[b+1]=d,a[b+2]=e,a}function getReferenceImage(a){if("IMG"==a.nodeName)return a;var b=window.getComputedStyle(a,null).backgroundImage;if(b){var c=new Image;return c.src=b.replace(/['"]/g,"").slice(4,-1),c}return!1}function placeReferenceImage(a,b,c){"IMG"==a.nodeName?c.src=b:a.style.backgroundImage="url("+b+")"}function addAttribute(a,b,c){var d=document.createAttribute(b);return d.nodeValue=c,a.setAttributeNode(d)}function flushDataAttributes(a){for(var b=0;b<a.attributes.length;b++){var c=a.attributes[b].name;"data-pb-"==c.substr(0,8)&&a.removeAttribute(c)}}function removeClasses(a){for(var b=a.className.toLowerCase().split(" "),c=0;c<b.length;c++)"filter-"==b[c].substr(0,7)&&removeClass(a,b[c])}function destroyStash(a,b){for(var c=a.className.toLowerCase().split(" "),e=0;e<c.length;e++){var f=c[e];if("pb-ref-"==f.substr(0,7)){var g=document.getElementById("pb-original-"+f.substr(7,f.length-7));b&&(a.src=g.src),removeClass(a,f),d=document.body,throwaway=d.removeChild(g)}}}function stashOriginal(a,b,c,d){var e=stashInDom(a,b);placeReferenceImage(c,d.toDataURL("image/png"),a),e&&(c.className+=" pb-ref-"+b)}function stashInDom(a,b){var c="pb-original-"+b;if(document.getElementById(c))return!1;var d=document.createElement("img");return d.src=a.src,d.id=c,d.style.display="none",document.body.appendChild(d),!0}addLoadEvent(function(){processFilters()});